name: Build

on:
  push:
    branches:
     - master
  pull_request:

jobs:
  build:
    name: Test build
    runs-on: ubuntu-latest
    container:
      image: 'devkitpro/devkita64'

    steps:
      - uses: actions/checkout@v4
        with:
          persist-credentials: false

      # - name: pacman  do not do this!!!!
        # run: | 
          # dkp-pacman -Syuu
          # dkp-pacman -Sy switch-dev switch-glm switch-libjpeg-turbo devkitARM devkitarm-rules hactool

      - name: get ubuntu version 
        run: | 
          cat /etc/os-release
          ldd --version ldd
          
      # - name: install python and pip 
        # run: | 
          # sudo apt-get update
          # sudo apt install -y make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev
          # wget https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz
          # tar xzf Python-2.7.18.tgz
          # cd Python-2.7.18
          # ./configure  
          # sudo make 
          # sudo make install
          # cd ..
          # ##sudo apt -y install python-pip
          # curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py
          # python get-pip.py   


      # - uses: actions/setup-python@v5
        # with:
          # python-version: '3.13' 
          
      - name: python install
        run: | 
          sudo apt-get update -y
          sudo apt-get install -y python3 python3-pip          
          
      # - name: Set up Python
        # uses: actions/setup-python@v5
        # with:
          # python-version: "3.13.3"
          
      - name: Install dependencies
        run: python -m pip install --upgrade pip lz4     
      
      - name: python / nproc test
        run: | 
          python --version
          nproc 
        
      - name: run fusee python script
        run: |
          cd fusee/program/
          python update_mtc_tables.py
          python update_sdram_params.py
          cd ../..


      # - name: make 
        # run: | 
          # git config --global --add safe.directory /__w/Atmosphere/Atmosphere 
          # cd troposphere/haze
          # make -j4
        
      - name: make 
        run: | 
          git config --global --add safe.directory /__w/Atmosphere/Atmosphere 
          cd troposphere/haze
          make -j4
          cd ../..
          make -j4

      - name: list out dir
        run: ls -la out  

      - uses: actions/upload-artifact@v4
        with:
          name: release
          path: ${{ github.workspace }}/out/nintendo_nx_arm64_armv8a
     
     


        